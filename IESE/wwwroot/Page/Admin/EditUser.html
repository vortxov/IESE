<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>EditUser</title>
    <link href="../../css/style.css" rel="stylesheet" />
</head>
<body>
    <header class="header">
        <nav class="top-menu">
            <ul class="menu-main">
                <li><a href="/index.html">Главная</a></li>
                <li><a href="/Page/PersonalAccount.html">Личный Кабинет</a></li>
                <li><a href="#">FAQ</a></li>
            </ul>
        </nav>
        <center><h1>Редактор пользователей:</h1></center>
        <form action="" method="get">
            <input class="Search1" name="s" placeholder="Поиск студента" type="search" size="50" height="">
            <button class="Search1" type="submit">Поиск</button>
        </form>



        <div id="errors" class="error" style="display:none;"></div>
        <div class="admincategory">
            <div class="error" id="errors"></div>
            <form class="menu__input" name="userForm">
                <input type="hidden" name="id" value="0" />
                <div class="row__input">
                    <input type="file" name="uploadedFile" id="uploadedFile" class="inputfile" />
                    <label class="inputfile__label" for="uploadedFile">Выбрать файл</label>
                </div>
                <div class="">
                    <button type="submit" id="submit" class="btn__menu__input">Сохранить</button>
                </div>
            </form>
            <center>
                <table class="table1">
                    <thead>
                        <tr>
                            <th>Фамилия</th>
                            <th>Имя</th>
                            <th>Отчество</th>
                            <th>Курс</th>
                            <th>Группа</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Gloria</td>
                            <td>Reeves</td>
                            <td>67439</td>
                            <td>10/18/1985</td>
                            <td>4</td>

                            <td><li><a href="../Admin/userinfo.html" <span style="text-decoration: underline; text-underline-offset: 5px; text-decoration-thickness: 2px;">Подробнее</span></a></li></td>
                        </tr>
                    </tbody>
                </table>
            </center>
        </div>
    </header>
    <script src="../../js/Main.js"></script>
    <script>

        async function PostUserFile(data) {

            const response = await fetch("/adminusers", {
                method: "POST",
                body: data,
            });
            if (response.ok === true) {
            }
            else {

                document.getElementById("errors").style.display = "block";
            }
        }

        document.forms["userForm"].addEventListener("submit", e => {
            e.preventDefault();
            const form = document.forms["userForm"];
            var myfile = form.elements["uploadedFile"].files;
            var data = new FormData();

            if (myfile.length > 0) {
                for (var i = 0; i < myfile.length; i++) {
                    data.append('File', myfile[i]);
                }
            }

            if (myfile.length == 0) {
                addError("Не выбран файл")
            }
            else {

                PostUserFile(data);
            }
        });


        async function GetTableUsers() {
            const response = await fetch("/adminusers/", {
                method: "GET",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
            });
            if (response.ok === true) {
                const users = await response.json();
                let rows = document.querySelector("tbody");
                users.forEach(user => {
                    rows.append(row(user));
                });
            }


        }


        function row(user) {
            const tr = document.createElement("tr");


            const tdFirstName = document.createElement("td");
            tdFirstName.append(user.firstname);
            tr.append(tdFirstName);

            const tdSurname = document.createElement("td");
            tdSurname.append(user.surname);
            tr.append(tdSurname);

            const tdPat = document.createElement("td");
            tdPat.append(user.patronymic);
            tr.append(tdPat);

            const tdCourse = document.createElement("td");
            tdCourse.append(user.course);
            tr.append(tdCourse);

            const tdGroup = document.createElement("td");
            tdGroup.append(user.group);
            tr.append(tdGroup);


            const tdlink = document.createElement("td");
            const lilink = document.createElement("li");
            const alinkdetail = document.createElement("a");
            alinkdetail.append("Подробнее");
            alinkdetail.href = "../Admin/userinfo.html?id=" + user.id;
            lilink.append(alinkdetail);
            const alinkarchive = document.createElement("a");
            alinkarchive.append("Его архив");
            alinkarchive.href = "../Admin/Archive.html?id=" + user.id;
            lilink.append(alinkarchive);
            tdlink.append(lilink);
            tr.append(tdlink);




            return tr;
        }

        async function CheckRole() {
            var role = await CheckAuthorizeRole();
            if (role != "admin") {
                const a = document.createElement('a');
                a.setAttribute('href', "/index.html");
                a.click();
            }
        }
        CheckRole();
        GetTableUsers();
    </script>
</body>
</html>