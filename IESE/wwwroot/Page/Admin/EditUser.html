<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>EditUser</title>
    <link href="../../css/style.css" rel="stylesheet" />
</head>
<body>
    <header class="header">
        <nav class="top-menu">
            <ul class="menu-main">
                <li><a href="AdminHome.html">Главная</a></li>
            </ul>
        </nav>
        <h4>Редактор пользователей</h4>
        <div id="errors" class="error" style="display:none;"></div>
        <div class="admincategory">
            <div class="error" id="errors"></div>
            <form class="menu__input" name="userForm">
                <input type="hidden" name="id" value="0" />
                <div class="row__input">
                    <input type="file" name="uploadedFile" id="uploadedFile" class="inputfile" />
                    <label class="inputfile__label" for="uploadedFile">Choose a file</label>
                </div>
                <div class="">
                    <button type="submit" id="submit" class="btn__menu__input">Сохранить</button>
                </div>
            </form>
            <table class="table1">
                <thead>
                    <tr>
                        <th>Имя</th>
                        <th>Фамилия</th>
                        <th>Отчество</th>
                        <th>Курс</th>
                        <th>Группа</th>
                        <th>Форма обучения</th>
                        <th>Факультет</th>
                        <th>Специальность</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Gloria</td>
                        <td>Reeves</td>
                        <td>67439</td>
                        <td>10/18/1985</td>
                        <td>4</td>
                        <td>0.1</td>
                        <td>$50</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </header>
    <script src="../../js/Main.js"></script>
    <script>

        async function PostUserFile(data) {

            const response = await fetch("/adminusers", {
                method: "POST",
                body: data,
            });
            if (response.ok === true) {
            }
            else {

                document.getElementById("errors").style.display = "block";
            }
        }

        document.forms["userForm"].addEventListener("submit", e => {
            e.preventDefault();
            const form = document.forms["userForm"];
            var myfile = form.elements["uploadedFile"].files;
            var data = new FormData();

            if (myfile.length > 0) {
                for (var i = 0; i < myfile.length; i++) {
                    data.append('File', myfile[i]);
                }
            }

            if (myfile.length == 0) {
                addError("Не выбран файл")
            }
            else {

                PostUserFile(data);
            }
        });

        async function CheckRole() {
            var role = await CheckAuthorizeRole();
            if (role != "admin") {
                const a = document.createElement('a');
                a.setAttribute('href', "/index.html");
                a.click();
            }
        }
        CheckRole();
    </script>
</body>
</html>