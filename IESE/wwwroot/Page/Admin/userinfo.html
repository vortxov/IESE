<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Данные пользователя</title>
    <link href="../../css/style.css" rel="stylesheet" />
</head>
<body>
    <header class="header">
        <nav class="top-menu">
            <ul class="menu-main">
                <li><a href="/index.html">Главная</a></li>
                <li><a href="/Page/PersonalAccount.html">Личный Кабинет</a></li>
                <li><a href="#">FAQ</a></li>
            </ul>
        </nav>
        <center><h1>Данные пользователя:</h1></center>

        <div id="errors" class="error" style="display:none;"></div>
        <div class="admincategory">
            <div class="error" id="errors"></div>
            <form class="menu__input" name="userForm">

                <div class="">
                    <button type="submit" id="submit" class="btn__menu__input">Сохранить</button>
                </div>
            </form>


            <table class="table444">
                <thead>
                    <tr>
                        <th>Фамилия</th>
                        <th>Специальность</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="One" class="userinfo" type="text" size="85"></td>
                        <td><input id="Nine" class="userinfo" type="text" size="85"></td>
                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Имя</th>
                        <th>Уровень квалификации</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Two" class="userinfo" type="text" size="85"></td>
                        <td><input id="Ten" class="userinfo" type="text" size="85"></td>

                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Отчество</th>
                        <th>Финансовое обеспечение</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Three" class="userinfo" type="text" size="85"></td>
                        <td><input id="Eleven" class="userinfo" type="text" size="85"></td>
                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Дата рождения</th>
                        <th>Электронная почта</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Four" class="userinfo" type="text" size="85"></td>
                        <td><input id="Twelve" class="userinfo" type="text" size="85"></td>
                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Курс</th>
                        <th>Год поступления</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Five" class="userinfo" type="text" size="85"></td>
                        <td><input id="Thirteen" class="userinfo" type="text" size="85"></td>
                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Группа</th>
                        <th>Год окончания</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Six" class="userinfo" type="text" size="85"></td>
                        <td><input id="Fourteen" class="userinfo" type="text" size="85"></td>
                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Форма обучения</th>
                        <th>Логин</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Seven" class="userinfo" type="text" size="85"></td>
                        <td><input id="Fifteen" class="userinfo" type="text" size="85"></td>
                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Факультет</th>
                        <th>Пароль</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Eight" class="userinfo" type="text" size="85"></td>
                        <td><input id="Sixteen" class="userinfo" type="text" size="85"></td>
                    </tr>
                </tbody>
            </table>
            <table class="table444">
                <thead>
                    <tr>
                        <th>Должность</th>

                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input id="Seventeen" class="userinfo" type="text" size="85"></td>

                    </tr>
                </tbody>
            </table>
        </div>
    </header>





    <script src="../../js/Main.js"></script>
    <script>
        async function CheckRole() {
            var role = await CheckAuthorizeRole();
            if (role != "admin") {
                const a = document.createElement('a');
                a.setAttribute('href', "/index.html");
                a.click();
            }
        }


        async function PostUser(data) {
            const response = await fetch("/adminusers/edit", {
                method: "POST",
                body: data,
            });
            if (response.ok === true) {
                const a = document.createElement('a');
                a.setAttribute('href', document.referrer);
                a.click();
            }
        }

        async function GetInfo(id) {
            const response = await fetch("/adminusers/" + id, {
                method: "GET",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
            });
            if (response.ok === true) {
                const user = await response.json();
                let one = document.querySelector("#One");
                one.value = user.firstname;
                let two = document.querySelector("#Two");
                two.value = user.surname;
                let Three = document.querySelector("#Three");
                Three.value = user.patronymic;
                let Four = document.querySelector("#Four");
                Four.value = user.birthDate;
                let Five = document.querySelector("#Five");
                Five.value = user.course;
                let Six = document.querySelector("#Six");
                Six.value = user.group;
                let Seven = document.querySelector("#Seven");
                Seven.value = user.formOfEducation;
                let Eight = document.querySelector("#Eight");
                Eight.value = user.faculty;
                let Nine = document.querySelector("#Nine");
                Nine.value = user.specialization;
                let Ten = document.querySelector("#Ten");
                Ten.value = user.qualificationLevel;
                let Eleven = document.querySelector("#Eleven");
                Eleven.value = user.financialSupport;
                let Twelve = document.querySelector("#Twelve");
                Twelve.value = user.email;
                let Thirteen = document.querySelector("#Thirteen");
                Thirteen.value = user.dateStartYear;
                let Fourteen = document.querySelector("#Fourteen");
                Fourteen.value = user.dateEndYear;
                let Fifteen = document.querySelector("#Fifteen");
                Fifteen.value = user.login;
                let Seventeen = document.querySelector("#Seventeen");
                Seventeen.value = user.role;
            }
        }

        document.forms["userForm"].addEventListener("submit", e => { 
            e.preventDefault();
            var data = new FormData();
            let one = document.querySelector("#One");
            data.append("Firstname", one.value);
            let two = document.querySelector("#Two");
            data.append("Surname", two.value);
            let Three = document.querySelector("#Three");
            data.append("Patronymic", Three.value);
            let Four = document.querySelector("#Four");
            data.append("BirthDate", Four.value);
            let Five = document.querySelector("#Five");
            data.append("Course", Five.value);
            let Six = document.querySelector("#Six");
            data.append("Group", Six.value);
            let Seven = document.querySelector("#Seven");
            data.append("FormOfEducation", Seven.value);
            let Eight = document.querySelector("#Eight");
            data.append("Faculty", Eight.value);
            let Nine = document.querySelector("#Nine");
            data.append("Specialization", Nine.value);
            let Ten = document.querySelector("#Ten");
            data.append("QualificationLevel", Ten.value);
            let Eleven = document.querySelector("#Eleven");
            data.append("FinancialSupport", Eleven.value);
            let Twelve = document.querySelector("#Twelve");
            data.append("Email", Twelve.value);
            let Thirteen = document.querySelector("#Thirteen");
            data.append("DateStartYear", Thirteen.value);
            let Fourteen = document.querySelector("#Fourteen");
            data.append("DateEndYear", Fourteen.value);
            let Fifteen = document.querySelector("#Fifteen");
            data.append("Login", Fifteen.value);
            let Seventeen = document.querySelector("#Seventeen");
            data.append("Role", Seventeen.value);
            let Sixteen = document.querySelector("#Sixteen");
            data.append("Password", Sixteen.value);
            data.append("Id", id);
            PostUser(data)
        });

        var id = window.location.href.split("?")[1].split("=")[1];

        GetInfo(id);
        CheckRole();
    </script>
</body>
</html>